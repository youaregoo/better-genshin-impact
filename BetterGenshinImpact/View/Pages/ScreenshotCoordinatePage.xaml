<UserControl x:Class="BetterGenshinImpact.View.Pages.ScreenshotCoordinatePage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pages="clr-namespace:BetterGenshinImpact.ViewModel.Pages"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             d:DataContext="{d:DesignInstance Type=pages:ScreenshotCoordinateViewModel}"
             d:DesignHeight="600"
             d:DesignWidth="800"
             ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
             ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
             FontFamily="{StaticResource TextThemeFontFamily}"
             Foreground="{DynamicResource TextFillColorPrimaryBrush}"
             mc:Ignorable="d">

    <Grid>
        <Grid Margin="42,16,42,12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 标题 -->
            <ui:TextBlock Grid.Row="0"
                          Margin="0,0,0,8"
                          FontTypography="BodyStrong"
                          Text="截图坐标识别" />
            
            <!-- 描述 -->
            <ui:TextBlock Grid.Row="1"
                          Margin="0,0,0,16"
                          Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                          TextWrapping="Wrap"
                          Text="上传游戏截图，自动识别当前位置的游戏坐标。支持 JPG、PNG、BMP 等常见图片格式。" />

            <!-- 操作按钮区域 -->
            <StackPanel Grid.Row="2" 
                        Orientation="Horizontal" 
                        Margin="0,0,0,16" 
                        HorizontalAlignment="Left">
                
                <ui:Button Command="{Binding SelectImageCommand}"
                           Content="选择截图"
                           Icon="{ui:SymbolIcon Image24}"
                           Margin="0,0,12,0" />
                
                <ui:Button Command="{Binding RecognizeCoordinatesCommand}"
                           Content="识别坐标"
                           Icon="{ui:SymbolIcon Location24}"
                           IsEnabled="{Binding SelectedImagePath, Converter={StaticResource StringToBoolConverter}}"
                           Margin="0,0,12,0" />
                
                <ui:Button Command="{Binding CopyCoordinatesCommand}"
                           Content="复制坐标"
                           Icon="{ui:SymbolIcon Copy24}"
                           IsEnabled="{Binding HasValidResult}"
                           Margin="0,0,12,0" />
                
                <ui:Button Command="{Binding ClearResultCommand}"
                           Content="清除"
                           Icon="{ui:SymbolIcon Delete24}"
                           Appearance="Secondary" />
            </StackPanel>

            <!-- 主要内容区域 -->
            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="300" />
                </Grid.ColumnDefinitions>

                <!-- 图片预览区域 -->
                <Border Grid.Column="0" 
                        BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Background="{ui:ThemeResource ControlFillColorDefaultBrush}">
                    
                    <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  ZoomMode="Enabled">
                        <Grid>
                            <!-- 预览图片 -->
                            <Image Source="{Binding PreviewImage}"
                                   Stretch="Uniform"
                                   Visibility="{Binding PreviewImage, Converter={StaticResource NullToVisibilityConverter}}" />
                            
                            <!-- 占位文本 -->
                            <TextBlock Text="选择图片后在此显示预览"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                       Visibility="{Binding PreviewImage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}" />
                        </Grid>
                    </ScrollViewer>
                </Border>

                <!-- 结果显示区域 -->
                <StackPanel Grid.Column="2">
                    
                    <!-- 识别状态 -->
                    <ui:Card Margin="0,0,0,16">
                        <StackPanel>
                            <ui:TextBlock Text="识别状态"
                                          FontTypography="BodyStrong"
                                          Margin="0,0,0,8" />
                            
                            <StackPanel Orientation="Horizontal" 
                                        Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ui:ProgressRing Width="16" Height="16" Margin="0,0,8,0" />
                                <TextBlock Text="正在处理..." />
                            </StackPanel>
                            
                            <TextBlock Text="{Binding RecognitionResult}"
                                       TextWrapping="Wrap"
                                       Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}" />
                        </StackPanel>
                    </ui:Card>

                    <!-- 坐标结果 -->
                    <ui:Card Visibility="{Binding HasValidResult, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <ui:TextBlock Text="识别结果"
                                          FontTypography="BodyStrong"
                                          Margin="0,0,0,8" />
                            
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0"
                                           Text="X坐标："
                                           Margin="0,0,8,4" />
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding RecognizedX, StringFormat=F1}"
                                           FontWeight="Bold"
                                           Margin="0,0,0,4" />

                                <TextBlock Grid.Row="1" Grid.Column="0"
                                           Text="Y坐标："
                                           Margin="0,0,8,4" />
                                <TextBlock Grid.Row="1" Grid.Column="1"
                                           Text="{Binding RecognizedY, StringFormat=F1}"
                                           FontWeight="Bold"
                                           Margin="0,0,0,4" />

                                <TextBlock Grid.Row="2" Grid.Column="0"
                                           Text="格式："
                                           Margin="0,0,8,0" />
                                <TextBlock Grid.Row="2" Grid.Column="1"
                                           Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}">
                                    <Run Text="{Binding RecognizedX, StringFormat=F1}" />
                                    <Run Text="," />
                                    <Run Text="{Binding RecognizedY, StringFormat=F1}" />
                                </TextBlock>
                            </Grid>
                        </StackPanel>
                    </ui:Card>
                </StackPanel>
            </Grid>

            <!-- 使用说明 -->
            <ui:InfoBar Grid.Row="4"
                        Title="使用说明"
                        Message="1. 点击"选择截图"选择包含地图的游戏截图&#x0a;2. 点击"识别坐标"开始分析图片&#x0a;3. 识别成功后可以复制坐标用于其他功能"
                        IsOpen="True"
                        IsClosable="False"
                        Severity="Informational"
                        Margin="0,16,0,0" />
        </Grid>
    </Grid>
</UserControl>